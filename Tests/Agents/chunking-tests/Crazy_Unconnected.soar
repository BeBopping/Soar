# Tests:
# - 

srand 23
smem --enable
chunk always

sp {elab*state-info*top
    (state <s> ^superstate nil)
-->
    (<s> ^state-info <i>)
    (<i> ^top-state <s>
         ^level 1)
}

sp {elab*state-info*substate
    (state <s> ^superstate <ss>)
    (<ss> ^state-info <i>)
    (<i> ^top-state <ts>
         ^level <l>)
-->
    (<s> ^state-info <i2>)
    (<i2> ^top-state <ts>
          ^level (+ <l> 1))
}

sp {anystate*operator
   (state <s> ^state-info.level <l>)
-->
   (<s> ^operator <op> + =)
   (<op> ^name <l>)
}


sp {generate*lti1
    (state <s> ^state-info.level 1)
-->
    (<s> ^foo <bar>)
    (<bar> ^lti1 @T1)
}

sp {generate*lti3
    (state <s> ^state-info.level 3)
-->
    (<s> ^foo <bar>)
    (<bar> ^lti3 @T3)
    (@T3 ^foo bar)
}

sp {generate*lti5
    (state <s> ^state-info.level 5)
-->
    (<s> ^foo <bar>)
    (<bar> ^lti5 @T5)
}

sp {generate*lti7
    (state <s> ^state-info.level 7)
-->
    (<s> ^foo <bar>)
    (<bar> ^lti7-1 @T1 ^lti7-3 @T3 ^lti7-5 @T5 ^lti7-7 @T7)
}

sp {apply*repair*rhs
    (state <s> ^foo.lti7-1 <t2>)
-->
    (write (crlf) |Creating chunk from level 4: | <s> (crlf))
    (<t2> ^alpha beta)
}
    
sp {apply*repair*rhs2
   (state <s> ^foo.lti7-3 <t2>
              ^superstate <ss>)
   (<t2> ^foo bar)
-->
   (write (crlf) |Creating chunk from level 4: | <s> (crlf))
   (<ss> ^result <t2>)
}